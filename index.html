<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Streamtape File Manager</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; }
        .section { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .tree-view { margin-left: 20px; }
        .folder { color: #1a73e8; cursor: pointer; margin: 5px 0; }
        .file { color: #137333; margin: 5px 0; }
        .id { color: #666; font-size: 0.9em; margin-left: 10px; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Streamtape File Manager</h1>

    <div class="section">
        <h2>Authentication</h2>
        <input type="text" id="login" placeholder="API Login">
        <input type="password" id="key" placeholder="API Key">
        <button onclick="listRoot()">Load Root Folder</button>
    </div>

    <div class="section">
        <h2>Current Folder: <span id="currentFolderName"></span></h2>
        <div id="folderPath"></div>
        <div id="fileTree" class="tree-view"></div>
    </div>

    <script>
        const API_BASE = 'https://api.streamtape.com';
        let currentFolder = { id: '', name: 'Root', path: [] };

        async function makeRequest(endpoint, params = {}) {
            const login = document.getElementById('login').value;
            const key = document.getElementById('key').value;
            
            const url = new URL(`${API_BASE}/${endpoint}`);
            url.searchParams.append('login', login);
            url.searchParams.append('key', key);
            
            Object.entries(params).forEach(([k, v]) => url.searchParams.append(k, v));
            
            try {
                const response = await fetch(url);
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
            }
        }

        async function listFolder(folderId = '', folderName = '') {
            if (folderId) {
                currentFolder.path.push({ id: currentFolder.id, name: currentFolder.name });
                currentFolder.id = folderId;
                currentFolder.name = folderName;
            }

            const data = await makeRequest('file/listfolder', { folder: currentFolder.id });
            
            if (data && data.result) {
                updateFolderDisplay(data.result);
            }
        }

        function listRoot() {
            currentFolder = { id: '', name: 'Root', path: [] };
            listFolder();
        }

        function updateFolderDisplay(folderData) {
            const treeContainer = document.getElementById('fileTree');
            const folderNameDisplay = document.getElementById('currentFolderName');
            const pathDisplay = document.getElementById('folderPath');

            // Update current folder name
            folderNameDisplay.textContent = folderData.name || 'Root';

            // Update folder path
            pathDisplay.innerHTML = currentFolder.path.map((f, i) => `
                <button onclick="navigateToPathIndex(${i})">${f.name}</button> ‚Ä∫ 
            `).join('') + currentFolder.name;

            // Build folder tree
            let html = '<h3>Folders:</h3>';
            
            if (folderData.folders && folderData.folders.length > 0) {
                folderData.folders.forEach(folder => {
                    html += `
                        <div class="folder" onclick="listFolder('${folder.id}', '${folder.name}')">
                            üìÅ ${folder.name}
                            <span class="id">ID: ${folder.id}</span>
                        </div>
                    `;
                });
            } else {
                html += '<div>No subfolders</div>';
            }

            html += '<h3>Files:</h3>';
            
            if (folderData.files && folderData.files.length > 0) {
                folderData.files.forEach(file => {
                    html += `
                        <div class="file">
                            üìÑ ${file.name} 
                            <span class="id">ID: ${file.id}</span>
                            <span class="size">(${formatBytes(file.size)})</span>
                        </div>
                    `;
                });
            } else {
                html += '<div>No files</div>';
            }

            treeContainer.innerHTML = html;
        }

        function navigateToPathIndex(index) {
            const targetFolder = currentFolder.path[index];
            currentFolder = {
                id: targetFolder.id,
                name: targetFolder.name,
                path: currentFolder.path.slice(0, index)
            };
            listFolder();
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
    </script>
</body>
  </html>
